!function(t){var e={};function n(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(i,a,function(e){return t[e]}.bind(null,a));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=3)}({3:function(t,e,n){t.exports=n("gjZA")},gjZA:function(t,e){var n,i,a,o,l,r,s,c,d,f,u,p,m,h,g,v,b,x,w,y,k,S,z,j=100,C=!1,D=!1,_=!1,O=!0;function P(){var t=o.width();if(!t||0===t)return setTimeout(P,500),!1;1===i.length&&($("#point-location-submit").on("click",function(t){a.val()&&(i.append('<div class="point admin" style="top:'+s+"px;left:"+r+'px"><input type="hidden" name="map_point[]" value="'+r+"-"+s+"-"+a.val()+'" /></div>'),n.modal("toggle"))}),E()),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),function(){1===m.length&&($("#draggable-map").draggable({drag:function(){C=!0},stop:function(){setTimeout(function(){C=!1},200)}}),m.mousemove(function(t){var e=b.offset();g=t.pageX-e.left,v=t.pageY-e.top}));1===c.length&&(c.on("click",function(t){t.preventDefault(),T(25)}),d.on("click",function(t){t.preventDefault(),T(-25)}),f.on("click",function(t){t.preventDefault(),j=100,T(0)}),p.on("click",function(t){t.preventDefault(),I(!1)}),u.on("click",function(t){t.preventDefault(),I(!0)}))}(),E(),k.click(function(t){$(this).hide(),_=!0,S.show(),b.addClass("map-admin-mode"),$.each($(".point"),function(t){$(this).draggable({disabled:!1})})}),S.click(function(t){$(this).hide(),_=!1,k.show(),b.removeClass("map-admin-mode"),M()}),$.each($(".point"),function(t){A($(this))}),M(),o.click(function(t){if(!1!==_&&!0!==D&&!0!==C){var e=$(this).offset();r=t.pageX-e.left-25,s=t.pageY-e.top-25,r<0&&(r=0),s<0&&(s=0),magnifier=j/100,s=parseInt(s)/magnifier,r=parseInt(r)/magnifier,$.ajax({url:$(this).data("url")+"?axis_y="+parseInt(s)+"&axis_x="+parseInt(r)}).done(function(t,e,i){t&&(h.html(t),R(),n.modal())}).fail(function(t,e,n){console.log("map point error",t)})}}),$(o).bind("wheel",function(t){!0===t.ctrlKey&&(t.preventDefault(),t.originalEvent.deltaY>0?T(-10):T(10))}),function(){var t=o.width();$(".loading-map").hide();o.height();var e=b.width(),n=(b.height(),e/t);j=Math.floor(100*n),T(0)}(),$(".map-point-legend").click(function(t){var e=$($(this).attr("href"));e.click()})}function T(t){l||(l=o.width());var e=j+t;if(e>300||e<10)return!1;d.removeAttr("disabled"),c.removeAttr("disabled"),j=e,magnifier=j/100,o.width(l*magnifier),t>0?0:0,$.each($(".point"),function(){N($(this),magnifier)}),j<=10?d.attr("disabled","disabled"):e>=300&&c.attr("disabled","disabled");var n=m.position();t>0?m.css("left",n.left-g/b.width()*100).css("top",n.top-v/b.height()*100):t<0&&m.css("left",n.left+g/b.width()*100).css("top",n.top+v/b.height()*100)}function E(){$.each($(".point"),function(t){$(this).unbind("click"),$(this).on("click",function(t){t.preventDefault(),!0!==D&&function(t){if(!0===C||!0===D)return;O&&(z.fadeOut(),O=!1);if(_)return void $.ajax({url:t.data("url-modal")}).done(function(t,e,i){t&&(h.html(t),R(),n.modal())}).fail(function(t,e,n){console.log("map point error",t)});x.hasClass("hidden")&&(x.removeClass("hidden"),$("#location-map-main").removeClass("col-md-12").addClass("col-md-9 col-sm-8"));y.show(),w.html(""),$(".point-focus").removeClass("point-focus"),t.addClass("point-focus"),$.ajax(t.data("url")).done(function(t){y.hide(),w.html(t),$(".entity-close").on("click",function(t){x.addClass("hidden"),$("#location-map-main").removeClass("col-md-9 col-sm-8").addClass("col-md-12")})})}($(this))})})}function I(t){t?(p.show(),u.hide(),$.each($(".map .point"),function(){$(this).show()})):(p.hide(),u.show(),$.each($(".map .point"),function(){$(this).hide()}))}function M(){$.each($(".point"),function(t){$(this).draggable({disabled:!0})})}function A(t){t.draggable({revert:!1,start:function(t,e){D=!0,target=$(t.target),target.addClass("point-moving")},stop:function(t,e){var n=$(t.target);return n.removeClass("point-moving"),r=e.position.left,s=e.position.top,magnifier=j/100,r/=magnifier,s/=magnifier,data={axis_x:r,axis_y:s},console.log("url move",n.data("url-move")),$.post(n.data("url-move"),data).done(function(t,e,n){}).fail(function(t,e,n){}),setTimeout(function(){D=!1},50),!0}})}function R(){initSelect2(),$(".map-point-delete").each(function(){$(this).click(function(t){return url=$(this).data("url"),t.preventDefault(),$.post({url:url,dataType:"json",data:{_method:"DELETE"},context:this}).done(function(t,e,i){t.id&&$("#"+t.id).remove(),n.modal("hide")}),!1})}),function(){$(".select2-icon").select2({templateResult:X,templateSelection:X,language:$(this).data("language")}),$(".select2-colour").select2({templateResult:Y,templateSelection:Y,language:$(this).data("language")}),$(".select2-shape").select2({templateResult:J,templateSelection:J,language:$(this).data("language")})}();var t=$(".phase-first"),e=$(".phase-second"),i=$(".point-save"),a=$(".point-entity"),o=$(".point-label");$("#phase-first-entity").on("click",function(n){n.preventDefault(),a.show(),t.hide(),e.show(),i.show()}),$("#phase-first-label").on("click",function(n){n.preventDefault(),o.show(),t.hide(),e.show(),i.show()}),$(".phase-undo").on("click",function(n){n.preventDefault(),e.hide(),i.hide(),a.hide(),o.hide(),t.show()}),$(".map-point-form").submit(function(t){var e=$(this).serialize();$.ajax({type:$(this).attr("method"),url:$(this).attr("action"),data:e,dataType:"json",encode:!0}).done(function(t){if(n.modal("hide"),t.point){var e=$("#"+t.id);1===e.length&&e.remove(),$(".map-container").append(t.point),E(),newPoint=$("#"+t.id),A(newPoint),magnifier=j/100,N(newPoint,magnifier),newPoint.tooltip()}}).fail(function(t){console.log("fail",t),t.responseJSON.errors&&$(".location-map-errors").html(function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e+=t[n]+"<br>");return e}(t.responseJSON.errors)).fadeIn()}),t.preventDefault()})}function N(t,e){t.css("top",t.data("top")*e+"px"),t.css("left",t.data("left")*e+"px"),t.css("width",t.data("size")*e+"px"),t.css("height",t.data("size")*e+"px"),fontSize=24,10===t.data("size")?fontSize=5:25===t.data("size")?fontSize=12:100===t.data("size")?fontSize=56:200===t.data("size")&&(fontSize=108),t.css("font-size",fontSize*e+"px")}function X(t){if(!t.id)return t.text;var e=$(t.element);if(!e)return t.text;var n=e.data("icon");if(n){if("entity"===n)return t.text;n.includes(" ")||(n="ra ra-"+n)}else n="ra ra-"+t.id;return $('<span><i class="'+n+'"></i> '+t.text+"</span>")}function Y(t){return"none"===t.id?t.text:$('<span><i class="fas fa-square-full" style="color: '+t.id+';"></i> '+t.text+"</span>")}function J(t){return"none"===t.id?t.text:$('<span><i class="fas fa-'+t.id+'"></i> '+t.text+"</span>")}$(document).ready(function(){i=$("#location-map-admin"),x=$("#location-map-panel"),w=$("#location-map-panel-target"),y=$("#location-map-panel-loading"),n=$("#point-location"),a=$("#location_id"),o=$("#location-map-image"),c=$("#map-zoom-in"),d=$("#map-zoom-out"),f=$("#map-zoom-reset"),p=$("#map-toggle-hide"),u=$("#map-toggle-show"),h=$("#map-point-body"),m=$("#draggable-map"),k=$("#map-admin-mode"),S=$("#map-view-mode"),b=$(".map"),z=$(".map-helper"),P()})}});